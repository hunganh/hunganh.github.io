window.variablesJS.divStatisticsShowData=document.getElementById("showStatisticsData"),window.variablesJS.divStatisticsTitle=document.getElementById("showStatisticsTitle"),window.statisticsJS={initStatisticsData:function(){window.commonJS.showLoading("showStatisticsLoading"),setTimeout((()=>{var t="selfBusiness"===window.variablesJS.typeDefault?window.variablesJS.TU_DOANH:window.variablesJS.KHOI_NGOAI;$.ajax({url:`${window.apiUrlDefined.STATISTICS_DATA_URL}/${t}`,async:!1,dataType:"json"}).done((function(t){if(t){var i=[],a=Object.keys(t);a&&a.length>0&&(a.forEach((a=>{"olderItem"===a?variablesJS.olderItem=t[a]:i.push(t[a])})),window.statisticsJS.processDataInput(i)),window.commonJS.hideLoading("showStatisticsLoading")}}))}),100)},processDataInput:function(t){if(window.variablesJS.divStatisticsShowData.innerHTML="",t&&t.length>0){t.forEach((i=>{window.variablesJS.dataJson?window.variablesJS.dataJson.items.push(i.items[0]):(window.variablesJS.dataJson=i,window.variablesJS.dataJson.totalCount=t.length)})),window.variablesJS.dataJson.items.sort((function(t,i){var a=new Date(t.today.toDate);return new Date(i.today.toDate)-a}));for(let t=0;t<window.variablesJS.dataJson.items.length;t++)for(let i=0;i<window.variablesJS.actions.length;i++)window.statisticsJS.createStatisticsReport(window.variablesJS.currentPeriod,window.variablesJS.dataJson.items[t],window.variablesJS.actions[i],t);window.statisticsJS.setStatisticsTitle()}window.commonJS.hideLoading("showStatisticsLoading")},resetStatisticsData:function(){window.commonJS.closePopover(),window.variablesJS.dataJson=null,window.variablesJS.mappingDataJson=null,window.variablesJS.divStatisticsShowData.innerHTML=""},refreshStatisticsData:function(){window.statisticsJS.resetStatisticsData(),window.statisticsJS.initStatisticsData()},readFileAsText:function(t){return new Promise((function(i,a){let e=new FileReader;e.onload=function(){i(e.result)},e.onerror=function(){a(e)},e.readAsText(t)}))},changeStatisticsType:function(t){window.statisticsJS.resetStatisticsData(),window.variablesJS.typeDefault=t,window.statisticsJS.initStatisticsData()},changeStatisticsAction:function(t){window.commonJS.closePopover(),window.commonJS.showLoading("showStatisticsLoading"),window.variablesJS.actionDefault=t,window.statisticsJS.processStatisticsData(variablesJS.currentPeriod),window.commonJS.hideLoading("showStatisticsLoading")},processStatisticsData:function(t){if(window.variablesJS.currentPeriod=t,window.variablesJS.dataJson&&window.variablesJS.dataJson.items&&window.variablesJS.dataJson.items.length>0){window.variablesJS.divStatisticsShowData.innerHTML="";for(let i=0;i<window.variablesJS.dataJson.items.length;i++)for(let a=0;a<window.variablesJS.actions.length;a++)window.statisticsJS.createStatisticsReport(t,window.variablesJS.dataJson.items[i],window.variablesJS.actions[a],i)}window.statisticsJS.setStatisticsTitle()},createStatisticsReport:function(t,i,a,e){var o="netBuy"===a?i[t].netBuy:i[t].netSell,n=window.commonJS.getNetTradeValueColumnByActionValue(a),s=" ("+new Date(i[t].fromDate).toLocaleDateString(window.variablesJS.defaultLocale)+" - "+new Date(i[t].toDate).toLocaleDateString(window.variablesJS.defaultLocale)+") - Tổng Giá Trị "+("netBuy"===a?"Mua Ròng: <span class='badge sum-value-area font-weight-bold font-14 dashed-border-bottom'>":"Bán Ròng: <span class='badge bg-danger font-weight-bold font-14 dashed-border-bottom'>")+new Intl.NumberFormat(window.variablesJS.numberLocale).format(i[t][n])+" đ </span>",d=document.createElement("table");d.classList.add("left-position","table","table-bordered","table-striped","table-hover");var w=document.createElement("thead"),r=w.insertRow(-1),l=document.createElement("th");l.setAttribute("colspan",9),l.innerHTML=s,r.appendChild(l),w.appendChild(r),d.appendChild(w),r=w.insertRow(-1);for(var c=0;c<window.variablesJS.statisticsHeadTitle.length;c++){var S=document.createElement("th");S.innerHTML=window.variablesJS.statisticsHeadTitle[c].indexOf("statistics-popover")>-1?window.variablesJS.statisticsHeadTitle[c].replace("statistics-popover","statistics-popover-"+a):window.variablesJS.statisticsHeadTitle[c],r.appendChild(S)}var m=document.createElement("tbody");for(m.setAttribute("id","table-statistics-popover-"+a),c=0;c<o.length;c++){(r=m.insertRow(-1)).setAttribute("onClick",`window.commonJS.showTickerInfor("${o[c].ticker}")`),r.classList.add("tr-cursor");var J=0===e&&window.variablesJS.dataJson.items.length>1?window.variablesJS.dataJson.items[e+1]:window.variablesJS.olderItem,b=window.commonJS.getColumnName(),v=window.commonJS.getVolumeColumnName();if(J){var u="netBuy"===a?J[t].netBuy.findIndex((t=>t.ticker===o[c][window.variablesJS.statisticsCols[1]])):J[t].netSell.findIndex((t=>t.ticker===o[c][window.variablesJS.statisticsCols[1]]));u>-1?window.commonJS.addCell(r,Number(c+1)+window.commonJS.getPositionIcon(u,c)):window.commonJS.addCell(r,Number(c+1))}else window.commonJS.addCell(r,Number(c+1));var f=o[c].priceChange,h=100*o[c].percentPriceChange,p=h>0||h<0?(f/o[c].percentPriceChange).toFixed(0):o[c].matchPrice,g=o[c].matchPrice;window.commonJS.addCell(r,Number(c+1)<=10?'<b class="top10">'+o[c].ticker+"</b>":o[c].ticker),window.commonJS.addCell(r,'<div class="text-left">'+window.commonJS.getIcbNameBySymbol(o[c].ticker)+"</div>"),window.commonJS.addCell(r,""!==v?new Intl.NumberFormat(window.variablesJS.numberLocale).format(o[c][v]):"&#8722;"),window.commonJS.addCell(r,new Intl.NumberFormat(window.variablesJS.numberLocale).format(o[c][b])),window.commonJS.addCell(r,'<span class="'+(Number(f)>0?"up":Number(f)<0?"down":"reference")+'">'+new Intl.NumberFormat(window.variablesJS.numberLocale).format(g)+"</span>"),window.commonJS.addCell(r,'<span class="'+(Number(f)>0?"up":Number(f)<0?"down":"reference")+'">'+new Intl.NumberFormat(window.variablesJS.numberLocale).format(f)+" ("+Number(h).toFixed(2)+"%)</span>"),window.commonJS.addCell(r,new Intl.NumberFormat(window.variablesJS.numberLocale).format(p))}d.appendChild(m),window.variablesJS.divStatisticsShowData.appendChild(d)},setStatisticsTitle:function(t){var i=(new Date).toLocaleDateString(window.variablesJS.defaultLocale),a=new Date(window.variablesJS.dataJson.items[0].today.toDate).toLocaleDateString(window.variablesJS.defaultLocale),e=` ${window.variablesJS.dataJson&&window.variablesJS.dataJson.items.length>0?"- Dữ liệu ngày "+a:""} `;a===i?(window.variablesJS.divStatisticsTitle.classList.remove("bg-out-of-date"),window.variablesJS.divStatisticsTitle.classList.add("bg-latest")):(window.variablesJS.divStatisticsTitle.classList.remove("bg-latest"),window.variablesJS.divStatisticsTitle.classList.add("bg-out-of-date")),window.variablesJS.divStatisticsTitle.innerHTML="Thống Kê ".concat("selfBusiness"===window.variablesJS.typeDefault?"Tổ Chức Trong Nước ":"Khối Ngoại ","Mua/Bán Ròng")+e,window.commonJS.closePopover();for(let t=0;t<window.variablesJS.actions.length;t++)window.commonJS.initIndustriesSelectionPopover("statistics-popover-"+window.variablesJS.actions[t])}},document.addEventListener("DOMContentLoaded",(function(t){window.statisticsJS.initStatisticsData()})),window.addEventListener("load",(function(){var t=document.getElementById("fileInput");t&&t.addEventListener("change",(function(){if(t.files.length>0){window.variablesJS.dataJson=null,window.variablesJS.divStatisticsShowData.innerHTML="",window.commonJS.showLoading("showStatisticsLoading");let i=[];for(let a=0;a<=t.files.length-1;a++)i.push(window.statisticsJS.readFileAsText(t.files[a]));Promise.all(i).then((t=>{var i=t.map((t=>JSON.parse(t)));window.variablesJS.olderItem=null,window.statisticsJS.processDataInput(i)}))}}),!1)}));